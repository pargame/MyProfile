---
layout: null
---
{%- assign studies = site.studies -%}
{%- assign projects = site.projects -%}
{%- assign obsidian = site.obsidian -%}
{%- assign all_docs = studies | concat: projects | concat: obsidian -%}

{%- assign study_archives = studies | map: "in" -%}
{%- assign project_archives = projects | map: "in" -%}
{%- assign obsidian_archives = obsidian | map: "path" | map: split: "/" | map: slice: 1, 1 | map: first -%}
{%- assign archives = study_archives | concat: project_archives | concat: obsidian_archives | uniq | compact -%}

{
  "archives": {{ archives | jsonify }},
  "documents": {
    {%- for doc in all_docs -%}
      {%- assign doc_id = doc.url | jsonify -%}
      {%- assign content_parts = doc.content | split: '[[' -%}
      {%- assign links = "" -%}
      {%- for part in content_parts offset: 1 -%}
        {%- assign link_title = part | split: ']]' | first | strip -%}
        {%- if link_title != "" -%}
          {%- for target_doc in all_docs -%}
            {%- if target_doc.title == link_title -%}
              {%- assign link_id = target_doc.url | jsonify -%}
              {%- assign links = links | append: link_id | append: "," -%}
              {%- break -%}
            {%- endif -%}
          {%- endfor -%}
        {%- endif -%}
      {%- endfor -%}
      {%- assign final_links = links | remove_last: "," | split: "," -%}

      {%- if doc.collection == "obsidian" -%}
        {%- assign archive_name = doc.path | split: "/" | slice: 1, 1 | first -%}
      {%- else -%}
        {%- assign archive_name = doc.in -%}
      {%- endif -%}

      {{ doc_id }}: {
        "title": {{ doc.title | jsonify }},
        "url": {{ doc.url | relative_url | jsonify }},
        "archive": {{ archive_name | jsonify }},
        "content": {{ doc.content | jsonify }},
        "links": {{ final_links | jsonify }}
      }{%- unless forloop.last -%},{%- endunless -%}
    {%- endfor -%}
  }
}
