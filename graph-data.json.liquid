---
layout: null
---
{%- assign studies = site.studies -%}
{%- assign projects = site.projects -%}
{%- assign all_docs = studies | concat: projects -%}
{%- assign archives = all_docs | map: "in" | uniq | compact -%}

{
  "archives": {{ archives | jsonify }},
  "documents": {
    {%- for doc in all_docs -%}
      {%- assign doc_id = doc.url | jsonify -%}
      {%- assign content_parts = doc.content | split: '[[' -%}
      {%- assign links = "" -%}
      {%- for part in content_parts offset: 1 -%}
        {%- assign link_title = part | split: ']]' | first | strip -%}
        {%- if link_title != "" -%}
          {%- for target_doc in all_docs -%}
            {%- if target_doc.title == link_title -%}
              {%- assign link_id = target_doc.url | jsonify -%}
              {%- assign links = links | append: link_id | append: "," -%}
              {%- break -%}
            {%- endif -%}
          {%- endfor -%}
        {%- endif -%}
      {%- endfor -%}
      {%- assign final_links = links | remove_last: "," | split: "," -%}
      {{ doc_id }}: {
        "title": {{ doc.title | jsonify }},
        "url": {{ doc.url | relative_url | jsonify }},
        "archive": {{ doc.in | jsonify }},
        "content": {{ doc.content | jsonify }},
        "links": {{ final_links | jsonify }}
      }{%- unless forloop.last -%},{%- endunless -%}
    {%- endfor -%}
  }
}