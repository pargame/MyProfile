---
layout: default
---
<script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.1/showdown.min.js"></script>

<style type="text/css">
  .graph-container { display: flex; flex-wrap: wrap; gap: 20px; }
  .graph-section { padding: 15px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9; }
  #archive-selector { width: 100%; }
  #document-list { width: 25%; min-width: 200px; height: 75vh; overflow-y: auto; }
  #document-content { flex-grow: 1; height: 75vh; overflow-y: auto; }
  #graph-diagram { width: 100%; height: 80vh; margin-top: 20px; }
  .archive-button { background: #eee; border: 1px solid #ccc; padding: 8px 12px; margin-right: 10px; cursor: pointer; border-radius: 5px; }
  .archive-button.active { background: #007bff; color: white; }
  #document-list ul { list-style: none; padding: 0; }
  #document-list a { display: block; padding: 5px; text-decoration: none; color: #333; }
  #document-list a:hover { background: #eee; }
</style>

<div class="post-content">
  <h1>Graph Archive</h1>
  <p>Select an archive to see the list of documents and their connections.</p>
</div>

<div class="graph-container">
  <div id="archive-selector" class="graph-section"></div>
  <div id="document-list" class="graph-section">
    <p>Select an archive first.</p>
  </div>
  <div id="document-content" class="graph-section">
    <p>Select a document to view its content.</p>
  </div>
  <div id="graph-diagram" class="graph-section"></div>
</div>

<script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function() {
    const converter = new showdown.Converter();
    const archiveSelector = document.getElementById('archive-selector');
    const docList = document.getElementById('document-list');
    const docContent = document.getElementById('document-content');
    const graphDiagram = document.getElementById('graph-diagram');
    let network = null;
    let allData = {};

    function renderGraph(nodes, edges) {
      if (network) {
        network.destroy();
      }
      const container = graphDiagram;
      const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
      const options = { /* ... vis.js options from previous implementation ... */ };
      network = new vis.Network(container, data, options);
      network.on("click", function (params) {
        if (params.nodes.length > 0) {
          const docId = params.nodes[0];
          renderDocumentContent(docId);
        }
      });
    }

    function renderDocumentContent(docId) {
        const doc = allData.documents[docId];
        if (doc) {
            docContent.innerHTML = converter.makeHtml(doc.content);
        }
    }

    function selectArchive(archiveName) {
      // Update active button
      document.querySelectorAll('.archive-button').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.archive === archiveName);
      });

      // Populate document list
      docList.innerHTML = '<ul></ul>';
      const ul = docList.querySelector('ul');
      const archiveDocs = Object.values(allData.documents).filter(d => d.archive === archiveName);
      archiveDocs.forEach(doc => {
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = "#";
        a.textContent = doc.title;
        a.onclick = (e) => {
          e.preventDefault();
          renderDocumentContent(doc.url);
        };
        li.appendChild(a);
        ul.appendChild(li);
      });

      // Render graph for the archive
      const nodes = archiveDocs.map(d => ({ id: d.url, label: d.title, group: d.archive }));
      const edges = [];
      archiveDocs.forEach(doc => {
        doc.links.forEach(linkId => {
          if (archiveDocs.some(d => d.url === linkId)) {
            edges.push({ from: doc.url, to: linkId });
          }
        });
      });
      renderGraph(nodes, edges);
      docContent.innerHTML = '<p>Select a document to view its content.</p>';
    }

    fetch('{{ "/graph-data.json" | relative_url }}')
      .then(response => response.json())
      .then(data => {
        allData = data;
        // Populate archive selector
        allData.archives.forEach(archive => {
          const button = document.createElement('button');
          button.textContent = archive;
          button.dataset.archive = archive;
          button.className = 'archive-button';
          button.onclick = () => selectArchive(archive);
          archiveSelector.appendChild(button);
        });
        graphDiagram.innerHTML = '<p>Select an archive to display the graph.</p>';
      })
      .catch(error => console.error('Error fetching graph data:', error));
  });
</script>